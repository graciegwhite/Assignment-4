---
title: "Assignment 4"
author: "Gracie White"
date: "November 12, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Packages and datasets
```{r, include = FALSE}
# Install necessary packages
library(tidyverse)
library(pwr)
library(knitr)
library(kableExtra)
library(plotly)
library(extrafont)
library(ggrepel)
library(vcdExtra)

# Load Datasets
lobster_size_df <- read_csv("lobster_size_abundance.csv")
traps_df <- read_csv("lobster_traps.csv")

```
##1. Initial Observations
```{r}
# Fishing Pressure
# First, filter the data so we only keep relevant info
traps5_df <- traps_df %>%
  select(YEAR, MONTH, FISHING_SEASON, SITE, TRAPS) %>%
  filter(SITE == "CARP" | SITE == "AQUE" | SITE == "IVEE" | SITE == "NAPL" | SITE == "MOHK") %>%
  group_by(SITE, YEAR) 
  
# Summary table of lobster traps each year by site  
trap5_sumtable <- summarize(traps5_df, med_traps = median(TRAPS), max_traps = max(TRAPS), mean_traps = mean(TRAPS), sd_traps = sd(TRAPS), sample_size = length(TRAPS)) %>% 
  mutate(MPA = ifelse(SITE == "IVEE" | SITE == "NAPL", "MPA", "No MPA"))

# Line graph of mean lobster traps by year for each site
traps_line_g <- ggplot(trap5_sumtable, aes(x = YEAR, y = mean_traps, group = SITE, color = SITE)) +
  geom_line(size = 1, alpha = 0.8, aes(linetype = MPA)) +
  labs(x = "Mean Lobster Traps", y = "Year", title = "Average Lobster Traps (2012-2017)")

traps_line_g

# looks like fishing pressure is decreasing over time
```
######Size Observations
```{r}
# Reformat size data into tidy format
# Filter sites and omit counts of "0"
lsize_allyears_df <- lobster_size_df %>% 
  filter(SITE == "AQUE"| SITE == "NAPL"| SITE == "MOHK"| SITE == "IVEE"| SITE == "CARP", COUNT != "0") %>% 
  select(YEAR, SITE, SIZE, COUNT)

lsize_expanded <- uncount(lsize_allyears_df, weights = COUNT, .remove = FALSE)
View(lsize_expanded)



```



####Part 2. Compare Mean Lobster Size by Site in 2017
```{r}
# Reformat size data into tidy format
# Filter sites and omit counts of "0"
lsize_sites_df <- lobster_size_df %>% 
  filter(SITE == "AQUE"| SITE == "NAPL"| SITE == "MOHK"| SITE == "IVEE"| SITE == "CARP", COUNT != "0", YEAR == "2017") %>% 
  select(YEAR, SITE, SIZE, COUNT)

View(lsize_sites_df)

# Expand Rows
lsize_expanded <- uncount(lsize_sites_df, weights = COUNT, .remove = FALSE)
View(lsize_expanded)
```


```{r}
# One variable (carapace length (mm)), 5 factors
# Perform one-sided ANOVA

# Identify hypotheses
# H0: Means across all groups are equal
# HA: At least two group means differ significantly
size_aov <- aov(SIZE ~ SITE, data = lsize_expanded)
summary(size_aov)

# Sample means are this different because they were most likely drawn for different population
# H0: Means across all groups are equal
# HA: At least two group means differ significantly

# p-value is <0.05 -> Reject the null.  There is a significant difference in means.  
# Sample means are this different because they were most likely drawn for different population
# Use post-hoc testing to see which sites differ

# Identify hypotheses
# H0:  There is no significant difference in pairwise means
# HA: There is a significant difference in pairwise means
size_pht <- TukeyHSD(size_aov)
size_pht

# p-value is <0.05 for sites (NAPL-CARP), (NAPL-IVEE)
# Reject the null for sites (NAPL-CARP), (NAPL-IVEE)

# Create a box-plot for visual mean comparison
size_bp <- ggplot(lsize_expanded, aes(x = SITE, y = SIZE)) +
  geom_boxplot(aes(color = SITE)) +
  ggtitle("Lobster Carapace Lengths at 5 LTER Sites in the Santa Barbara Channel, 2017") +
  xlab("Site") +
  ylab("Carapace Length (mm)") +
  theme_classic() +
  scale_colour_brewer("Site", palette = "Set2")
size_bp

# Create a data summary table to compare means
size_sum_df <- lsize_expanded %>% 
  group_by(SITE) %>% 
  summarize(count = n(), 
    mean = mean(SIZE),
    sd = sd(SIZE))
size_sum_df
```

####Part 3. Changes in lobster size at MPA and non-MPA sites (comparing only 2012 and 2017 sizes)
```{r}
# MPA Sites: IVEE, NAPL
# Non-MPA Sites: IVEE, NAPL

# Reformat size data into tidy format
# Filter sites and omit counts of "0"
lsize_sitesmpa_df <- lobster_size_df %>% 
  filter(SITE == "AQUE"| SITE == "NAPL"| SITE == "MOHK"| SITE == "IVEE"| SITE == "CARP", COUNT != "0",
         YEAR == "2012"| YEAR == "2017") %>% 
  select(YEAR, SITE, SIZE, COUNT)

View(lsize_sitesmpa_df)

# Expand Rows
lsizempa_expanded <- uncount(lsize_sitesmpa_df, weights = COUNT, .remove = FALSE)
View(lsizempa_expanded)

# Use t-tests to compare means


```

